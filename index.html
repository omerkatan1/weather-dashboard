<!DOCTYPE html>
<html>

<head>
    <title>Weather Dashboard</title>

    <!-- linking css sheet -->
    <link rel="stylesheet" href="Assets/style.css">

    <!-- jquery link -->
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <!-- bootstrap link -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- linking moments.js -->
    <script src="https://momentjs.com/downloads/moment.js"></script>


</head>

<!-- header -->
<header>
    <h1 id="header-title">Weather Dashboard</h1>

</header>


<!-- search navbar -->
<div id="searchBox">

    <div id="searchBar">
        <input class="col-8" type="text" id="cityNameSearch" placeholder="Ex: London, UK">
        <button class="col-4" id="cityNameSubmit">Submit</button>
    </div>

    <div id="newBtnSearch"></div>
</div>


<div id="pagecontent" class="container-fluid">

    <div class="row">

        <!-- empty col -->
        <div class="col-2"></div>


        <div id="currentWeatherBox" class="col-8">

            <image id="iconHolder"></image>
            <h4 id="date"></h4>
            <h1 id="city"></h1>
            <h1 id="temp"></h1>
            <h5 id="humidity"></h5>
            <h5 id="windspeed"></h5>
            <h5 id="UVindex"></h5>

        </div>

        <!-- empty col -->
        <div class="col-2"></div>


    </div>

</div>





<script>


    // EVERYTHING TO DO WITH THE WEATHER API
    var key = "f2c5c8025ab4a4cc77dc112a270a04b9";



    // this is the saved button for local storage
    var savedCitys = [];
    var savedCityParse = JSON.parse(localStorage.getItem("city"));
    console.log(savedCityParse);
    console.log(savedCitys);

    if (savedCityParse != null) {
        for (var i = 0; i < savedCityParse.length; i++) {
            savedCitys.push(savedCityParse[i]);

            var newBtn = $("<button>");
            newBtn.addClass("savedBtnStyle");
            newBtn.append(savedCitys[i]);
            newBtn.attr("data-name", savedCityParse[i]);
            $("#newBtnSearch").append(newBtn);
        }
    }
    else {
        console.log("savedCityParse is empty");
    }





    $("#cityNameSubmit").click(function () {

        var city = $("#cityNameSearch").val();
        currentWeatherURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + key;


        $.ajax({
            url: currentWeatherURL,
            method: "GET"
        }).then(function (response) {
            console.log(response);


            savedCitys.push(response.name);
            var newBtn = $("<button>");
            newBtn.addClass("savedBtnStyle");
            newBtn.append(response.name);
            $("#newBtnSearch").append(newBtn);
            localStorage.setItem("city", JSON.stringify(savedCitys));





            // city name stuff
            var getCity = response.name;
            $("#city").empty();
            $("#city").append(getCity);

            // data and time stuff
            var getDate = moment().format('ll');
            $("#date").empty();
            $("#date").append(getDate);

            // temp stuff
            var getTemp = parseInt(response.main.temp);
            $("#temp").empty();
            $("#temp").append(getTemp + " Â°F");

            // humidity stuff
            var getHumidity = response.main.humidity;
            $("#humidity").empty();
            $("#humidity").append("Humidity: " + getHumidity + " %");


            //wind speed stuff
            var getSpeed = response.wind.speed;
            $("#windspeed").empty();
            $("#windspeed").append("Windspeed: " + getSpeed + " mph");

            // icon stuff
            var getIconURL = "http://openweathermap.org/img/wn/" + response.weather[0].icon + "@2x.png";
            $("#iconHolder").attr("src", getIconURL);



            var lat = response.coord.lat;
            var lon = response.coord.lon;

            var uvQueryURL = "http://api.openweathermap.org/data/2.5/uvi/forecast?appid=" + key + "&lat=" + lat + "&lon=" + lon;


            $.ajax({
                url: uvQueryURL,
                method: "GET"
            }).then(function (uvResponse) {

                var getUvIndex = uvResponse[0].value;

                $("#UVindex").empty();
                $("#UVindex").prepend("UV index: " + getUvIndex);


            });

        });

    });

</script>

</html>